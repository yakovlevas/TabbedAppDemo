<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TabbedAppDemo.Views.Tab4Page"
             Title="Tinkoff API"
             xmlns:converters="clr-namespace:TabbedAppDemo.Converters">

    <ContentPage.Resources>
        <converters:BoolToConnectionTextConverter x:Key="BoolToConnectionTextConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <Label Text="Tinkoff Invest API" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>

            <!-- ÐŸÐ¾Ð»Ðµ Ð´Ð»Ñ API ÐºÐ»ÑŽÑ‡Ð° -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource LightGray}, Dark={StaticResource DarkGray}}"
                   Padding="15"
                   CornerRadius="10">
                <VerticalStackLayout Spacing="10">
                    <Label Text="API ÐšÐ»ÑŽÑ‡ Tinkoff Invest:" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>

                    <Entry Text="{Binding ApiKey}" 
                           Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ API ÐºÐ»ÑŽÑ‡..."
                           IsPassword="True"
                           BackgroundColor="Transparent"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                           PlaceholderColor="Gray"/>

                    <Button Text="â“ ÐšÐ°Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ API ÐºÐ»ÑŽÑ‡" 
                            Command="{Binding ShowApiHelpCommand}"
                            BackgroundColor="Gray"
                            TextColor="White"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource LightGray}, Dark={StaticResource DarkGray}}"
                   Padding="15"
                   CornerRadius="10">
                <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                    <!-- ÐšÑ€ÑƒÐ³ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° -->
                    <Frame WidthRequest="20" 
                           HeightRequest="20" 
                           CornerRadius="10" 
                           Padding="0"
                           BackgroundColor="{Binding ConnectionColor}"/>

                    <!-- Ð¢ÐµÐºÑÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° -->
                    <Label Text="{Binding ConnectionStatus}" 
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                           VerticalTextAlignment="Center"
                           FontSize="16"/>
                </HorizontalStackLayout>
            </Frame>

            <!-- ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource LightGray}, Dark={StaticResource DarkGray}}"
                   Padding="15"
                   CornerRadius="10">
                <VerticalStackLayout Spacing="10">
                    <Label Text="ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº API:" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>

                    <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                        <Switch IsToggled="{Binding IsConnectionToggleEnabled, Mode=TwoWay}"
                                IsEnabled="{Binding CanTestConnection}"
                                HorizontalOptions="Start"/>

                        <Label Text="{Binding IsConnectionToggleEnabled, Converter={StaticResource BoolToConnectionTextConverter}}"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               VerticalTextAlignment="Center"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼ -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Text="ðŸ“ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡" 
                        Command="{Binding LoadSavedTokenCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        Grid.Column="0"/>

                <Button Text="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡" 
                        Command="{Binding SaveTokenCommand}"
                        IsEnabled="{Binding CanSaveToken}"
                        BackgroundColor="{StaticResource Success}"
                        TextColor="White"
                        Grid.Column="1"/>
            </Grid>

            <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                               IsVisible="{Binding IsLoading}"
                               Color="{StaticResource Primary}"
                               HorizontalOptions="Center"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>